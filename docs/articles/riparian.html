<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>riparian â€¢ riparian</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="riparian">
<meta property="og:description" content="riparian">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">riparian</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/riparian.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/methods.html">Research Methods</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/crumplecup/riparian/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="riparian_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>riparian</h1>
                        <h4 class="author">Erik Rose</h4>
            
            <h4 class="date">2021-03-18</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/crumplecup/riparian/blob/master/vignettes/riparian.Rmd"><code>vignettes/riparian.Rmd</code></a></small>
      <div class="hidden name"><code>riparian.Rmd</code></div>

    </div>

    
    
<p>Welcome to the <code>vignette</code> for the package <code>riparian</code>, a suite of tools designed to help Benton County Community Development staff analyze riparian cover extent and change in cover over time. This document models the workflow of producing an annual monitoring report for the Benton County riparian monitoring program, and demonstrates how functions in the <code>riparian</code> package can make monitoring faster and more efficient for the researcher.</p>
<div id="step-one-site-plots" class="section level2">
<h2 class="hasAnchor">
<a href="#step-one-site-plots" class="anchor"></a>Step One: Site Plots</h2>
<p>Benton County conducts riparian monitoring whenever new high resolution (1-foot) orthographic imagery becomes available. Likely, your are reading this because new imagery is about to arrive.</p>
<p>The County currently monitors 54 randomly selected sites along priority corridors, and may add additional sites based upon future permit approvals. The reason we look at the same 54 sites every year is because we are trying to detect change in cover. If we looked at a different slew of sites each year, it would be hard to know whether an increase or decrease in cover were due to variation between the sites we selected, or whether vegetation removal or accrual occurred. Using this method, we can circle individual trees that have gone missing from one year to the next. Because the sites are randomly selected and representative of conditions in the priority corridor generally, we can be reasonably confident that changes in cover within the sample reflect conditions in the priority corridor.</p>
<div id="the-library-path" class="section level3">
<h3 class="hasAnchor">
<a href="#the-library-path" class="anchor"></a>The Library Path</h3>
<p>The standard library of a programming language reflects a stable but limited number of core features. User-defined libraries allow the community to experiment with alternative implementations of more complex features before incorporating a chosen method into the standard library, or the feature may indefinitely remained as user-defined code on github or CRAN. Some of the more powerful and user-friendly libraries in R are available on the official R archive, CRAN, but to employ their functionality we must first download the source code and compile it on our workstation. Most users of R do not need to know the location of the library path where R stores code from externally downloaded libraries. If you using a workstation that is not linked into the county network, then you probably do not need to know, either.</p>
<p>If you using a county computer linked into the network, as of 2021 there is an additional security firewall in place that confuses Rstudio when it tries to locate the library path. We need to manually insert the correct path into the list of places that Rstudio looks. If you are starting a fresh session of RStudio, remember to set the path to your personal package library using the .libPaths() function.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># add your personal library path to libPaths</span>
<span class="co"># remember to run this at the start of every Rstudio() session!</span>
<span class="co"># replace 'P:/lib' with the path to a dedicated folder in your workspace</span>
<span class="fu"><a href="https://rdrr.io/r/base/libPaths.html">.libPaths</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span> <span class="st">'P:/lib'</span>, <span class="fu"><a href="https://rdrr.io/r/base/libPaths.html">.libPaths</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span></code></pre></div>
</div>
<div id="sampling-boxes" class="section level3">
<h3 class="hasAnchor">
<a href="#sampling-boxes" class="anchor"></a>Sampling Boxes</h3>
<p>The <code>riparian</code> package contains several data objects related to riparian monitoring in Benton County. You can access these data objects by name using the <code><a href="https://rdrr.io/r/utils/data.html">data()</a></code> function, or they will load automatically with the rest of package when using `library(). Access the polygon shapefile containing the 54 sampling boxes as shown:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load the package, all associated functions and data objects</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://crumplecup.github.io/riparian">riparian</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'riparian'</span>
<span class="co">#&gt; The following object is masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     within</span>

<span class="co"># alternative method: access the sampling box object without loading the full package</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">random_samples</span>, package <span class="op">=</span> <span class="st">'riparian'</span><span class="op">)</span>

<span class="co"># use the sf package to plot the first box</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_zm.html">st_zm</a></span><span class="op">(</span><span class="va">random_samples</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">'Example Sampling Box'</span><span class="op">)</span></code></pre></div>
<p><img src="riparian_files/figure-html/samples-1.png" width="700"></p>
<p>In 2018, the County collected orthographic imagery in S:/maps/OrthoPhotos, with each year of imagery in a separate folder. Each raster file is typically a large file covering a broad extent of the county. Performing operations on these files is expensive, and when using the county network can slow traffic for others and increase the risk of dropped connections or other errors. If you can copy the years of interest to an external drive, this can minimize network traffic and speed performance at your workstation. However, due to the size of the data, orthographic data from the whole county will likely not fit on hard drive of a laptop.</p>
<p>Compared the size of the survey images, the monitoring boxes are relatively small. The <code><a href="../reference/thumbnails.html">thumbnails()</a></code> functions produces smaller raster files just big enough to fit a given set of sampling boxes. These raster files are small enough to fit on a laptop without impeding performance, allowing one to conduct the remainder of the analysis without being tethered to an external drive or the county network.</p>
</div>
<div id="thumbnail-images" class="section level3">
<h3 class="hasAnchor">
<a href="#thumbnail-images" class="anchor"></a>Thumbnail Images</h3>
<p>The <code><a href="../reference/thumbnails.html">thumbnails()</a></code> function takes three arguments. <code>in_path</code> is the directory path for orthoimagery. <code>out_path</code> is the directory in which to print the thumbnail images. <code>polys</code> is the sampling box spatial object.</p>
<p>R uses the convention of forward slashes in path names (for instance, the path to my working folder for this project is â€˜P:/Riparianâ€™ and the path to the 2018 imagery is â€˜S:/maps/OrthoPhotos/Oregon2018â€™). The function expects a character string, so the path name needs to have single or double quotes around it. When you run this function, it will produce a .tif file in the output directory centered around each sampling box in the <code>polys</code> argument.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># crop small images of the sampling area and print to personal drive</span>
<span class="fu"><a href="../reference/thumbnails.html">thumbnails</a></span><span class="op">(</span>in_path <span class="op">=</span> <span class="st">'S:/maps/OrthoPhotos/Oregon2018'</span>,
           out_path <span class="op">=</span> <span class="st">'P:/Riparian'</span>,
           polys <span class="op">=</span> <span class="va">random_samples</span><span class="op">)</span></code></pre></div>
</div>
<div id="sample-plots" class="section level3">
<h3 class="hasAnchor">
<a href="#sample-plots" class="anchor"></a>Sample Plots</h3>
<p>In order to assess the level of cover over a sample area, we need to project the lines of the sampling box over the new orthographic imagery. The function for printing these plots is called <code><a href="../reference/plot_samples.html">plot_samples()</a></code>. The full syntax for the function is <code><a href="../reference/plot_samples.html">plot_samples(in_path, out_path, polys = random_samples, year, type = 'random', method = 'lm')</a></code>. Letâ€™s break down these arguments one by one.</p>
<p>The first argument is called <code>in_path</code> and it is the path to the directory of orthographic imagery. If you made a directory of thumbnails, use this directory as your <code>in_path</code> argument. The second argument is <code>out_path</code>, and specifies the location where the function will print the sample plots. The third argument, <code>polys</code> is the polygon shapefile of sampling boxes.</p>
<p>The <code>year</code> argument is an integer that represents the year of orthographic survey. Do not try getting fancy and entering â€˜year = 2020junâ€™ or somesuch, because the tools in this package use this number a lot. Each one is expecting an integer and will break if they do not get one.</p>
<p>The <code>type</code> argument, on the other hand, is entirely there for your convenience. You can even safely ignore it. In 2018, I wanted to know if the level of cover was different in taxlots where the county had issued permits that might affect the riparian zone, compared to the priority corridor as a whole. I labeled random samples in the riparian corridor as â€˜randomâ€™ and samples where the county had issued permits as â€˜permitâ€™. The <code>type</code> argument is expecting a word of your choice wrapped in quotes. Other tools in the <code>riparian</code> package allow you to filter your sample pool by the <code>type</code> names you specify.</p>
</div>
<div id="predicting-cover" class="section level3">
<h3 class="hasAnchor">
<a href="#predicting-cover" class="anchor"></a>Predicting Cover</h3>
<p>The <code><a href="../reference/plot_samples.html">plot_samples()</a></code> function predicts the level of cover in each slice of the sampling box using a linear regression fit to the record of sample observations from 2018, 2016 and 2009. The function adds a green bar to the outer edge of the sample box where it predicts full cover, yellow on slices of partial cover, and red on slices of bare ground. The function also outputs a spreadsheet containing the predicted values, correctly formatted for later use by other tools in this package. The spreadsheet output can save you labor by automatically scoring easy calls.</p>
<p>Currently the <code><a href="../reference/plot_samples.html">plot_samples()</a></code> function defaults to using a linear model that expects 4-band imagery (rgbn) as an input. If you are using 3-band imagery (rgb), then you can tell the function to use a different linear model using the <code>method</code> argument. For 3-band imagery, use the argument <code>method = 'lm3'</code>.</p>
<p>The default <code>polys = 'random_samples'</code> means the function looks for an object called <code>random_samples</code> in the current environment, so you can omit this argument for the random annual monitoring boxes if you have loaded <code>random_samples</code> into the current environment. You can omit the argument names in a function call and R will process the arguments in the order given, but if you omit arguments to use the default, or otherwise provide function arguments out of order, then you need to include the name of specific arguments in the function call.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://crumplecup.github.io/riparian">riparian</a></span><span class="op">)</span>

<span class="co"># change the path names</span>
<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span><span class="op">(</span><span class="st">'/path_to_shapefile/'</span><span class="op">)</span>
<span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu">rgdal</span><span class="fu">::</span><span class="fu"><a href="http://rgdal.r-forge.r-project.org/reference/readOGR.html">readOGR</a></span><span class="op">(</span><span class="st">'mysamples.shp'</span><span class="op">)</span>

<span class="co"># change the path names</span>
<span class="co"># change year value to your year</span>
<span class="co"># use method = 'lm3' for 3-band rgb imagery</span>
<span class="fu"><a href="../reference/plot_samples.html">plot_samples</a></span><span class="op">(</span>in_path <span class="op">=</span> <span class="st">'S:/maps/OrthoPhotos/Oregon2018'</span>,
             out_path <span class="op">=</span><span class="st">'P:/riparian/sites2018'</span>,
             polys <span class="op">=</span> <span class="va">random_samples</span>,
             year <span class="op">=</span> <span class="fl">2018</span>,
             type <span class="op">=</span> <span class="st">'random'</span>,
             method <span class="op">=</span> <span class="st">'lm'</span><span class="op">)</span></code></pre></div>
<center>
<img src="examples/sample_22_2020.png" width="650"><br><strong>Example Sample Plot</strong>
</center>
<p>The <code>plot_samples</code> function prints a .png file into the <code>out_path</code> directory for each sampling box in the <code>polys</code> object, showing the sampling box superimposed over the aerial imagery, with slices labeled by number (as shown in the example plot above).</p>
</div>
</div>
<div id="scoring-samples" class="section level2">
<h2 class="hasAnchor">
<a href="#scoring-samples" class="anchor"></a>Scoring Samples</h2>
<p>Once you have printed sampling plots for all sites, it is time to score cover extent.</p>
<p>In 2018 I created an excel file called <code>samples2018.xlsx</code> to record cover extent for the 2018 annual monitoring report and the 5-year trends and status report. In order for the functions in <code>riparian</code> to work correctly, it is important for you to format your record of observations exactly like the spreadsheet from 2018. First, letâ€™s take a look at that spreadsheet by loading it into the workspace. You can examine the data as a native R object, loaded automatically with the riparian package, or using the <code>data</code> function.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load the package, if you have not already done so</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://crumplecup.github.io/riparian">riparian</a></span><span class="op">)</span>

<span class="co"># alternative method, load the data object without the rest of the package</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">samples2018</span>, package <span class="op">=</span> <span class="st">'riparian'</span><span class="op">)</span>

<span class="co"># examine column names of observations spreadsheet</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">samples2018</span><span class="op">)</span>
<span class="co">#&gt;  [1] "id"   "year" "type" "1"    "2"    "3"    "4"    "5"    "6"    "7"   </span>
<span class="co">#&gt; [11] "8"    "9"    "10"   "11"   "12"   "13"   "14"   "15"   "16"   "17"  </span>
<span class="co">#&gt; [21] "18"   "19"   "20"   "21"   "22"   "23"   "24"   "25"   "26"   "27"  </span>
<span class="co">#&gt; [31] "28"   "29"   "30"   "31"   "32"   "33"   "34"   "35"   "36"   "37"  </span>
<span class="co">#&gt; [41] "38"   "39"   "40"   "41"   "42"   "43"   "44"   "45"   "46"   "47"  </span>
<span class="co">#&gt; [51] "48"   "49"   "50"</span></code></pre></div>
<p>The spreadsheet has 53 columns, named <code>id</code>, <code>year</code>, <code>type</code> and then numbered 1:50. Your spreadsheet must adhere to this format, using 53 columns named just so. The <code>id</code> column refers to an individual site id associated with each site. The <code>year</code> column specifies the year of observation. The <code>type</code> column is for grouping sites into subsets, such as sites with active permits to track compared to random samples, and may be left blank without consequence. The columns numbered 1:50 correspond to the numbers on the sample plots printed by <code><a href="../reference/plot_samples.html">plot_samples()</a></code>. When you are scoring observations, enter the cover score associated with the number on the sampling plot under the column with the same number in the spreadsheet.</p>
<p>The easiest way to adhere to the format requirement manually is to add new observations to the bottom of the 2018 spreadsheet, and save it under a new name. You can convert the R object into a csv file using the command <code><a href="https://rdrr.io/r/utils/write.table.html">write.csv(samples2018, 'myobs.csv')</a></code> and fill in your observations using Excel. If you are using the spreadsheet output from <code>sample_plots()</code>, then the spreadsheet is already formatted correctly.</p>
<p>When you are done editing your file in Excel, export it into csv format, which is a tried and true way to share data between programs. Read the csv into RStudio using the <code>data.table</code> package:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># once you have entered cover extent scores into a spreadsheet saved as a csv</span>
<span class="co"># load the csv into R</span>
<span class="co"># change 'myobs.csv' to the path name to your file</span>
<span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html">fread</a></span><span class="op">(</span><span class="st">'myobs.csv'</span><span class="op">)</span>

<span class="co"># as of 2021, data.table adds an index column when it reads from a csv</span>
<span class="co"># drop the added column (the first one), keeping the original data</span>
<span class="va">obs</span> <span class="op">&lt;-</span> <span class="va">obs</span><span class="op">[</span> , <span class="op">-</span><span class="fl">1</span><span class="op">]</span>

<span class="co"># your spreadsheet should have matching columns with samples2018</span>
<span class="co"># so you can bind them together by row to create a new master record</span>
<span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="va">obs</span>, <span class="va">samples2018</span><span class="op">)</span>

<span class="co"># save the master record as csv</span>
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">obs</span>, <span class="st">'samples_MyYear.csv'</span><span class="op">)</span>
<span class="co"># or as a data object</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">obs</span>, file <span class="op">=</span> <span class="st">'samples_MyYear.rds'</span><span class="op">)</span></code></pre></div>
<p>If you are using the predicted cover spreadsheet, then as you inspect each site plot, observe whether each slice is assigned the correct cover class. Where the predicted class is incorrect, you can update the spreadsheet in Excel. The column names correspond to the slice numbers on the site plot, and the rows of the spreadsheet will be in the order of the sampling boxes fed to the <code><a href="../reference/plot_samples.html">plot_samples()</a></code> function. So long as you do not have to do too much manual editing, the prediction feature has the potential to save time compared to manually scoring each slice from scratch.</p>
<p>Note that while you can cut and paste the corrected scores onto the end of the previous observations in Excel, you can also bind them together easily in R using the native function <code><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind()</a></code>.</p>
<div id="subsetting-sites" class="section level3">
<h3 class="hasAnchor">
<a href="#subsetting-sites" class="anchor"></a>Subsetting Sites</h3>
<p>The <code>riparian</code> package takes advantage of several features of the <code>data.table</code> package. The <code>data.table</code> is a special class of <code>data.frame</code>, with unique syntax for subsetting data.</p>
<p>The first subsetting you will likely want to do is subset by year. Do this by selecting the column <code>year</code> and setting it equal to the target value. Place this logical test in brackets following the data.table name, and R will return only those observations that pass the test. Note that logical tests use two equal signs (eg. <code>year == 2018</code>).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com">data.table</a></span><span class="op">)</span>
<span class="co"># print summary table of obs by year</span>
<span class="va">samples2018</span><span class="op">[</span> , <span class="va">.N</span>, by <span class="op">=</span> <span class="va">year</span><span class="op">]</span>
<span class="co">#&gt;    year   N</span>
<span class="co">#&gt; 1: 2018 170</span>
<span class="co">#&gt; 2: 2016 169</span>
<span class="co">#&gt; 3: 2009  54</span>

<span class="co"># subset year of interest</span>
<span class="va">sub18</span> <span class="op">&lt;-</span> <span class="va">samples2018</span><span class="op">[</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2018</span><span class="op">]</span>

<span class="co"># verify subset is correct</span>
<span class="va">sub18</span><span class="op">[</span> , <span class="va">.N</span>, by <span class="op">=</span> <span class="va">year</span><span class="op">]</span>
<span class="co">#&gt;    year   N</span>
<span class="co">#&gt; 1: 2018 170</span></code></pre></div>
<p>The <code>type</code> variable is a catch-all for you to define and compare groups within the sample. The 2018 dataset includes a type value <code>permit</code>, which refers to sites with active permits we selected for random monitoring. We can split the dataset into two groups by using <code><a href="https://rdrr.io/r/base/Comparison.html">==</a></code> and <code><a href="https://rdrr.io/r/base/Comparison.html">!=</a></code> (not equal) to divide the data by <code>type</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># print table of obs by type</span>
<span class="va">samples2018</span><span class="op">[</span> , <span class="va">.N</span>, by <span class="op">=</span> <span class="va">type</span><span class="op">]</span>
<span class="co">#&gt;      type   N</span>
<span class="co">#&gt; 1: random  27</span>
<span class="co">#&gt; 2:   trib 231</span>
<span class="co">#&gt; 3: permit 135</span>

<span class="co"># subset permit and nopermit sites</span>
<span class="va">permit_sites</span> <span class="op">&lt;-</span> <span class="va">samples2018</span><span class="op">[</span><span class="va">type</span> <span class="op">==</span> <span class="st">'permit'</span><span class="op">]</span>
<span class="va">nopermit_sites</span> <span class="op">&lt;-</span> <span class="va">samples2018</span><span class="op">[</span><span class="va">type</span> <span class="op">!=</span> <span class="st">'permit'</span><span class="op">]</span>

<span class="co"># examine results</span>
<span class="va">permit_sites</span><span class="op">[</span> , <span class="va">.N</span>, by <span class="op">=</span> <span class="va">type</span><span class="op">]</span>
<span class="co">#&gt;      type   N</span>
<span class="co">#&gt; 1: permit 135</span>
<span class="va">nopermit_sites</span><span class="op">[</span> , <span class="va">.N</span>, by <span class="op">=</span> <span class="va">type</span><span class="op">]</span>
<span class="co">#&gt;      type   N</span>
<span class="co">#&gt; 1: random  27</span>
<span class="co">#&gt; 2:   trib 231</span></code></pre></div>
<p>To subset by multiples criteria, you can subset sequentially or use logical operators <code><a href="https://rdrr.io/r/base/Logic.html">&amp;</a></code> and <code><a href="https://rdrr.io/r/base/Logic.html">|</a></code> to nest multiple logical tests.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># subset 2018 sites with type trib or permit</span>
<span class="va">sub</span> <span class="op">&lt;-</span> <span class="va">samples2018</span><span class="op">[</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2018</span><span class="op">]</span>
<span class="va">sub</span> <span class="op">&lt;-</span> <span class="va">sub</span><span class="op">[</span><span class="va">type</span> <span class="op">==</span> <span class="st">'trib'</span> <span class="op">|</span> <span class="va">type</span> <span class="op">==</span> <span class="st">'permit'</span><span class="op">]</span>

<span class="co"># verify subset has correct number of obs</span>
<span class="va">sub</span><span class="op">[</span>, <span class="va">.N</span>, by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">year</span>,<span class="va">type</span><span class="op">)</span><span class="op">]</span>
<span class="co">#&gt;    year   type   N</span>
<span class="co">#&gt; 1: 2018   trib 116</span>
<span class="co">#&gt; 2: 2018 permit  50</span>

<span class="co"># subset 2016 sites with type trib or permit</span>
<span class="va">sub</span> <span class="op">&lt;-</span> <span class="va">samples2018</span><span class="op">[</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2016</span><span class="op">]</span>
<span class="va">sub</span> <span class="op">&lt;-</span> <span class="va">sub</span><span class="op">[</span><span class="va">type</span> <span class="op">==</span> <span class="st">'trib'</span> <span class="op">|</span> <span class="va">type</span> <span class="op">==</span> <span class="st">'permit'</span><span class="op">]</span>

<span class="co"># verify subset has correct number of obs</span>
<span class="va">sub</span><span class="op">[</span>, <span class="va">.N</span>, by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">year</span>, <span class="va">type</span><span class="op">)</span><span class="op">]</span>
<span class="co">#&gt;    year   type   N</span>
<span class="co">#&gt; 1: 2016   trib 115</span>
<span class="co">#&gt; 2: 2016 permit  50</span></code></pre></div>
</div>
</div>
<div id="plot-cover-extent" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-cover-extent" class="anchor"></a>Plot Cover Extent</h2>
<p>The function <code><a href="../reference/plot_cover.html">plot_cover(csv)</a></code> produces a plot of cover extent over all the samples in the object <code>csv</code>. To produce a plot of cover extent for a given year, subset the observations in the data.table by year in the argument to <code><a href="../reference/plot_cover.html">plot_cover()</a></code>. Optional arguments: the argument <code>title</code> sets the name of the .png file printed into the working directory. The argument <code>heading</code> sets a title for the plot (default is blank). The argument <code>leg_pos</code> adjusts the legend position and accepts the arguments <code>topright</code>, <code>topleft</code>, <code>bottomright</code> and <code>bottomleft</code>. You may need to adjust the legend position from its default so it does not cover the data you are trying to display.</p>
<p>Note that a table of statistics prints to the console. Copy these values into an Excel file to create tables of summary statistics for cover extent in your monitoring report. The function also produces a plot of cover extent (example shown below). The green line is the cumulative distribution function for cover extent, and it shows the proportion of total samples that are at or below the level of cover on the x-axis. The gray vertical bar shows mean cover extent, and the dotted blue lines show the 95% confidence interval around that mean.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://crumplecup.github.io/riparian">riparian</a></span><span class="op">)</span>
<span class="co"># plot cover extent for all samples in 2018 using default settings</span>
<span class="fu"><a href="../reference/plot_cover.html">plot_cover</a></span><span class="op">(</span><span class="va">samples2018</span><span class="op">[</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2018</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt;           mean        sd   n       upr       lwr</span>
<span class="co">#&gt; [1,] 0.7319412 0.3300731 170 0.7815595 0.6823229</span>
<span class="co"># plot cover extent for all samples in 2009, specifying a heading and output name</span>
<span class="fu"><a href="../reference/plot_cover.html">plot_cover</a></span><span class="op">(</span><span class="va">samples2018</span><span class="op">[</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2009</span><span class="op">]</span>, 
           title <span class="op">=</span> <span class="st">'my_cover_plot.png'</span>, 
           heading <span class="op">=</span> <span class="st">'Cover Extent 2009'</span><span class="op">)</span>
<span class="co">#&gt;           mean        sd  n       upr       lwr</span>
<span class="co">#&gt; [1,] 0.8172222 0.2556192 54 0.8854016 0.7490429</span>
<span class="co"># plot cover extent for non-tributary samples in 2018, specifying legend location</span>
<span class="fu"><a href="../reference/plot_cover.html">plot_cover</a></span><span class="op">(</span><span class="va">samples2018</span><span class="op">[</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2018</span> <span class="op">&amp;</span> <span class="va">type</span> <span class="op">!=</span> <span class="st">'trib'</span><span class="op">]</span>, leg_pos <span class="op">=</span> <span class="st">'topleft'</span><span class="op">)</span>
<span class="co">#&gt;           mean        sd  n       upr       lwr</span>
<span class="co">#&gt; [1,] 0.8416667 0.2417917 54 0.9061579 0.7771755</span></code></pre></div>
<center>
<img src="my_cover_plot.png" width="650"><br><strong>my_cover_plot.png</strong>
</center>
</div>
<div id="plot-cover-change" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-cover-change" class="anchor"></a>Plot Cover Change</h2>
<p>The function <code><a href="../reference/plot_change.html">plot_change(csv, year1, year2)</a></code> produces a plot of cover extent change from <code>year1</code> to <code>year2</code> across samples in <code>csv</code>. Here the function does the subsetting for you in the case of year, but you can still subset <code>csv</code> by type. The optional arguments are the same as for <code>plot_cover</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot cover change from 2016 to 2018 using default settings</span>
<span class="fu"><a href="../reference/plot_change.html">plot_change</a></span><span class="op">(</span><span class="va">samples2018</span>, <span class="fl">2016</span>, <span class="fl">2018</span><span class="op">)</span>
<span class="co">#&gt;             mean         sd   n         upr        lwr</span>
<span class="co">#&gt; [1,] -0.01047619 0.09416389 168 0.003763017 -0.0247154</span>
<span class="co"># plot cover change in non-tributary samples from 2016 to 2018</span>
<span class="fu"><a href="../reference/plot_change.html">plot_change</a></span><span class="op">(</span><span class="va">samples2018</span><span class="op">[</span><span class="va">type</span> <span class="op">!=</span> <span class="st">'trib'</span><span class="op">]</span>, <span class="fl">2016</span>, <span class="fl">2018</span><span class="op">)</span>
<span class="co">#&gt;              mean         sd  n        upr         lwr</span>
<span class="co">#&gt; [1,] -0.002962963 0.06778517 54 0.01511685 -0.02104277</span>
<span class="co"># plot cover change from 2009 to 2016, specifying heading, output name, and leg_pos</span>
<span class="fu"><a href="../reference/plot_change.html">plot_change</a></span><span class="op">(</span><span class="va">samples2018</span>, <span class="fl">2009</span>, <span class="fl">2016</span>, 
           title <span class="op">=</span> <span class="st">'my_change_plot.png'</span>, 
           heading <span class="op">=</span> <span class="st">'Type your heading here.'</span>,
           leg_pos <span class="op">=</span> <span class="st">'topright'</span><span class="op">)</span>
<span class="co">#&gt;            mean         sd  n        upr        lwr</span>
<span class="co">#&gt; [1,] 0.02740741 0.05857378 54 0.04303034 0.01178448</span></code></pre></div>
<center>
<img src="my_change_plot.png" width="650"><br><strong>my_change_plot.png</strong>
</center>
</div>
<div id="clean-permit-list" class="section level2">
<h2 class="hasAnchor">
<a href="#clean-permit-list" class="anchor"></a>Clean Permit List</h2>
<p>A staff member from the planning department will email you an Excel sheet containing all permits the County has issued since the last monitoring report. Reading the file into R will require a little extra work preparing the data in Excel. Open the permit list in Excel, and note that the first column should be <code>Record Number</code> and the fifth should read <code>MapTaxlot #</code>. Likely, many of the MapTaxlot numbers will be printed in scientific notation in their cells. That is a problem, because R will interpret the cells as character vectors, and the ending 7 digits of the MapTaxlot number will be lost. But first, scroll down and note the first cell where the MapTaxlot number has a little green triangle in the upper left corner. In order to avoid MapTaxlot numbers displaying in scientific notation, some planning staff display numbers as text in the Excel formatting options. This is problematic because Excel converts them back to numbers and hence to scientific notation when exporting the file in csv format, and then R interprets it as a character string again.</p>
<p>Click on the first cell where a MapTaxlot number has the green triangle in the upper left corner, then scroll to the last permit on the sheet and click on its MapTaxlot number while holding the shift key so that you select the entire column below the cell with the green triangle. Scroll back to the first cell you selected and click on the yellow exclamation point, bringing down a dropdown menu. From the menu select <code>Convert to Number</code>, and watch all the numbers displayed as text revert to scientific notation.</p>
<p>Now scroll to the top of the sheet and select the whole column for <code>MapTaxlot #</code>. Right click on a cell in the highlighted column and click on <code>Format Cells...</code>. The <code>number</code> tab should display. Select from the <code>Category</code> menu <code>Number</code>. Change <code>Decimal places</code> from 2 to 0. Click <code>OK</code>. With all MapTaxlot numbers converted to number strings and displayed as integers, it is now safe to export the sheet as a csv file to import into R. Select <code>Save As</code>, choose a directory, and from the <code>Save as type</code> menu select <code>CSV (Comma delimited)</code>.</p>
<p>Read the <code>csv</code> file into R using the same <code>fread</code> command as for the cover score sheet. To demonstrate the functionality of the package, I have included a list of permits from 2013 to 2018 as a package object, which you can access by loading the <code>riparian</code> library or using the <code>data</code> function.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load the riparian library, if you have not already done so</span>
<span class="co"># the permit list from 2013 to 2018 is saved in the package as `permits_13to18`</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://crumplecup.github.io/riparian">riparian</a></span><span class="op">)</span>

<span class="co"># examine column names of the permit list spreadsheet</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">permits_13to18</span><span class="op">)</span>
<span class="co">#&gt;  [1] "record_no"         "record_type"       "proj_name"        </span>
<span class="co">#&gt;  [4] "description"       "maptaxlot"         "numer"            </span>
<span class="co">#&gt;  [7] "dir"               "street_name"       "street_type"      </span>
<span class="co">#&gt; [10] "post_dir"          "unit_no"           "city"             </span>
<span class="co">#&gt; [13] "status"            "related_records"   "opened"           </span>
<span class="co">#&gt; [16] "expires"           "balance"           "created_by"       </span>
<span class="co">#&gt; [19] "assigned_to_staff"</span>

<span class="co"># Note we have renamed the columns 'Record Number' and 'MapTaxlot #' </span>
<span class="co"># from the planning department's original list of permits to</span>
<span class="co"># 'record_no' and 'maptaxlot', in order to eliminate the use of spaces and</span>
<span class="co"># non-alphanumeric characters, which are invalid in data object names. </span>

<span class="co"># Change the names of the first and fifth column of the new permit list in Excel  </span>
<span class="co"># to match the original list before you load the new permit list </span>
<span class="co"># from the planning department.</span>

<span class="co"># Make sure to convert maptaxlot #s from scipen to integers before importing.  </span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Edit the file path to point to your csv file.</span>
<span class="va">perms</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html">fread</a></span><span class="op">(</span><span class="st">'/path_to_file/my_permits.csv'</span><span class="op">)</span>

<span class="co"># not all permits issued by the county include property in the riparian corridor.  </span>
<span class="co"># subset properties from the permit list within the priority corridor </span>
<span class="co"># using the sf_lots object, a set of polygons of taxlots in the priority corridor.</span>
<span class="va">perm_sub</span> <span class="op">&lt;-</span> <span class="va">perms</span><span class="op">[</span><span class="va">perms</span><span class="op">$</span><span class="va">maptaxlot</span> <span class="op">%in%</span> <span class="va">sf_lots</span><span class="op">$</span><span class="va">MapTaxlot</span>, <span class="op">]</span>

<span class="co"># Bind the new permit list to the old by row into a single exhaustive permit list.</span>
<span class="co"># The columns of old and new must match (in name and number), or this will fail.</span>
<span class="va">perms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="va">perm_sub</span>, <span class="va">permits_13to18</span><span class="op">)</span>

<span class="co"># Save the exhaustive list as a data object or csv file.</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">perms</span>, file <span class="op">=</span> <span class="st">'/path_to_drive/my_permit_list.rds'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">perms</span>, file <span class="op">=</span> <span class="st">'/path_to_drive/my_permit_list.csv'</span><span class="op">)</span></code></pre></div>
</div>
<div id="change-tables" class="section level2">
<h2 class="hasAnchor">
<a href="#change-tables" class="anchor"></a>Change Tables</h2>
<p>The planning staff is concerned with which map taxlots have experienced net cover decrease, especially if the decrease is greater than 10%. The <code><a href="../reference/build_change_table.html">build_change_table()</a></code> function produces a change table designed for use by the planning staff. The purpose of this tool is to enable staff to locate where change is occurring, which property owners are involved, and whether any county issued permits may be related. The change table ranks sampling sites by mean cover change, and includes columns with all MapTaxlot numbers falling within the sampling box and all permits associated with a MapTaxlot on the permit list.</p>
<p>The full syntax for the function is <code><a href="../reference/build_change_table.html">build_change_table(csv, year1, year2, polys, lots, permits)</a></code>. The argument <code>csv</code> is the record of cover scores for the sampling sites. The arguments <code>year1</code> and <code>year2</code> are integers matching values in the <code>year</code> column of <code>csv</code>. The argument <code>polys</code> is the spatial polygons object of samplings boxes. The argument <code>lots</code> is the polygons object of MapTaxlots, and <code>permits</code> is the permit list formatted according to the instructions in the previous section. The output is a csv file printed to the working directory.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/build_change_table.html">build_change_table</a></span><span class="op">(</span>csv <span class="op">=</span> <span class="va">samples2018</span>,
                   year1 <span class="op">=</span> <span class="fl">2016</span>,
                   year2 <span class="op">=</span> <span class="fl">2018</span>,
                   polys <span class="op">=</span> <span class="va">random_samples</span>,
                   lots <span class="op">=</span> <span class="va">sf_lots</span>, 
                   permits <span class="op">=</span> <span class="va">permits_13to18</span><span class="op">)</span></code></pre></div>
<div class="figure">
<embed src="change_table_2016-2018.csv"></embed><p class="caption">â€˜build_change_table output:â€™</p>
</div>
<p>When a change table indicates that the cover extent has decreased, it is important to ascertain whether the decrease is the result of measurement error or actual canopy cover decline.</p>
<ul>
<li>Inspect the sample plots from the previous and current year. Can you identify cover loss?</li>
<li>If you can identify specific trees or limbs that have been removed, create a slide showing the before and after image with the removal circled to present to planning staff.</li>
<li>Try to ascertain on which map taxlot the removal occurred and include the number.</li>
<li>Include all permit numbers from the change table column associated with the sample.</li>
<li>If no discernible loss has occurred, but changes in camera aspect cause the position of tree canopy relative to the sampling box to move, record as measurement error and disregard.</li>
<li>We ignore this type of error because it is random (as likely to make cover go up as down) and small relative to sizes of changes we are measuring.</li>
<li>If no discernible loss has occurred, but shading effects caused disparate scores between years, correct the shaded record to match the fully visible record and rerun the analysis.</li>
<li>If the corrected record is a prior year, include a corrections table for the prior year in your final report.</li>
</ul>
<div id="comparing-areas-with-permits-to-random-areas" class="section level3">
<h3 class="hasAnchor">
<a href="#comparing-areas-with-permits-to-random-areas" class="anchor"></a>Comparing Areas with Permits to Random Areas</h3>
<p>If cover were to decline in areas where the county has issued permits, the question would naturally arise as to whether permits were a cause. The county also monitors randomly selected areas in priority riparian corridors. If cover also decreased in randomly selected areas, it is unlikely permits were the primary cause of decline. If cover decreased significantly more in permitted areas, then we could not rule out permits as a potential cause. Whether permits are a plausible cause of cover decline depends on the broader context of how cover is changing in the priority corridor as a whole.</p>
<p>To compare the difference in mean cover extent between samples of different types in the same year, we use the <code>t.test</code> function included in the <code>stats</code> package, part of Râ€™s standard library. First, remember that each surveying box contains 50 slices, which we need to aggregate into a mean cover score. Each surveying box has a mean cover extent, and we are comparing the mean of mean cover extents in one group to another. So, after calculating mean cover extent for each row of data, subset the data into distinct groups using the <code>year</code> and <code>type</code> variables.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># cover score observations from 2009-2018</span>
<span class="va">dt</span> <span class="op">&lt;-</span> <span class="va">samples2018</span>

<span class="co"># use apply to convert each row of score observations</span>
<span class="co"># into a mean cover extent per sampling box</span>
<span class="va">dt</span><span class="op">$</span><span class="va">mn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">dt</span><span class="op">[</span>,<span class="fl">4</span><span class="op">:</span><span class="fl">53</span><span class="op">]</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span>

<span class="co"># subset random samples and permit samples for 2018</span>
<span class="va">dt_random</span> <span class="op">&lt;-</span> <span class="va">dt</span><span class="op">[</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2018</span> <span class="op">&amp;</span> <span class="va">type</span> <span class="op">==</span> <span class="st">'random'</span>, <span class="op">]</span>
<span class="va">dt_permit</span> <span class="op">&lt;-</span> <span class="va">dt</span><span class="op">[</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2018</span> <span class="op">&amp;</span> <span class="va">type</span> <span class="op">==</span> <span class="st">'permit'</span>, <span class="op">]</span>

<span class="co"># welch two-sample t-test</span>
<span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">dt_random</span><span class="op">$</span><span class="va">mn</span>, <span class="va">dt_permit</span><span class="op">$</span><span class="va">mn</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Welch Two Sample t-test</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  dt_random$mn and dt_permit$mn</span>
<span class="co">#&gt; t = -0.81752, df = 3.277, p-value = 0.4689</span>
<span class="co">#&gt; alternative hypothesis: true difference in means is not equal to 0</span>
<span class="co">#&gt; 95 percent confidence interval:</span>
<span class="co">#&gt;  -0.6193033  0.3565033</span>
<span class="co">#&gt; sample estimates:</span>
<span class="co">#&gt; mean of x mean of y </span>
<span class="co">#&gt;    0.7200    0.8514</span></code></pre></div>
<p>Note the confidence interval associated with the Welch two-sample t-test in your monitoring report. If the confidence interval overlaps zero, the two sample means are not statistically distinguishable from one another with 95% confidence.</p>
</div>
</div>
<div id="sampler" class="section level2">
<h2 class="hasAnchor">
<a href="#sampler" class="anchor"></a>Sampler</h2>
<p>The time will come when you need to draw new sampling boxes to sample new places. Typically the County will approve new permits and flag those permits that may result in reduction of cover in the priority corridor. Your bosses may ask you to include newly permitted areas in your sample. The <code><a href="../reference/sample_streams.html">sample_streams()</a></code> function generates new sampling boxes along the priority corridor within the area of your choice.</p>
<p>The full syntax for the function is <code><a href="../reference/sample_streams.html">sample_streams(n=100, lots=sf_lots, prc=sf_per, strms=sf_strms)</a></code>. The argument <code>n</code> is the number of sampling boxes you want to produce, and defaults to 100. The argument <code>prc</code> is the line file along which the function generates random points. The default (<code>sf_per</code>) is the NHD set of perennial or fish-bearing streams, clipped to the extent of the RR zone, and you should be able to leave the default as is.</p>
<p>The argument <code>strms</code> defaults to the WSI hydro-enforced drainage layer clipped to the priority corridor (<code>sf_strms</code>). The WSI hydro-enforced drainage layer is more accurate than the NHD dataset, so the function finds the nearest point on the WSI layer to the random point generated on the NHD layer, and draws the sampling box around that point.</p>
<p>The argument <code>lots</code> is the polygon object that specifies the area within which you want to draw samples, and defaults to the whole priority corridor (<code>sf_lots</code>). If you have a list of permitted sites to check, then clip the <code>sf_lots</code> object down to only those taxlots you want to check, and specify the location of the resulting object in the <code>lots</code> argument.</p>
<p>What we casually refer to as random numbers in computer code refer to pseudo-random number generators, or complex deterministic algorithms. Deterministic means that we will get exactly the same output given a specific input, what we call a <code>seed</code>. By setting the <code>seed</code> in R, you can generate a string of seemingly random numbers that is reproducible. Consider it a best practice to set and record your seed before taking random samples, especially for research involving the public.</p>
<p>To demonstrate the function, I will generate a random sample of lots within the priority corridor, then draw sample boxes using <code><a href="../reference/sample_streams.html">sample_streams()</a></code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># let's say you did this earlier</span>
<span class="va">perms</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html">fread</a></span><span class="op">(</span><span class="st">'/path_to_file/my_permits.csv'</span><span class="op">)</span>  <span class="co"># my new permit list</span>
<span class="va">perm_sub</span> <span class="op">&lt;-</span> <span class="va">perms</span><span class="op">[</span><span class="va">perms</span><span class="op">$</span><span class="va">maptaxlot</span> <span class="op">%in%</span> <span class="va">sf_lots</span><span class="op">$</span><span class="va">MapTaxlot</span>, <span class="op">]</span>  <span class="co"># permits within corridor</span>
<span class="va">perms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="va">perm_sub</span>, <span class="va">permits_13to18</span><span class="op">)</span>  <span class="co"># merge together old and new permits</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">perms</span>, file <span class="op">=</span> <span class="st">'/path_to_drive/my_permit_list.rds'</span><span class="op">)</span>  <span class="co"># save as R data object</span>

<span class="co"># load the saved permit list</span>
<span class="co"># this loads the object named `perms` created above within a new session</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">'/path_to_drive/my_permit_list.rds'</span><span class="op">)</span>

<span class="co"># subset lots in the riparian corridor where the maptaxlot number</span>
<span class="co"># matchs one of the maptaxlot numbers in the permit list</span>
<span class="va">permit_lots</span> <span class="op">&lt;-</span> <span class="va">sf_lots</span><span class="op">[</span><span class="va">sf_lots</span><span class="op">$</span><span class="va">MapTaxlot</span> <span class="op">%in%</span> <span class="va">perms</span><span class="op">$</span><span class="va">maptaxlot</span>, <span class="op">]</span>

<span class="co"># always set the seed immediately prior to taking the random sample</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">777</span><span class="op">)</span>

<span class="co"># sample 10 spots from permitted lots in the riparian corridor</span>
<span class="va">new_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sample_streams.html">sample_streams</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span>, lots <span class="op">=</span> <span class="va">permit_lots</span><span class="op">)</span></code></pre></div>
<div id="bad-sampling-boxes" class="section level3">
<h3 class="hasAnchor">
<a href="#bad-sampling-boxes" class="anchor"></a>Bad Sampling Boxes</h3>
<p>The sampling tool has known bugs that cause sampling boxes to fail to draw correctly. I would offer an expected date when these bugs might be resolved, but letâ€™s just say I was lucky to get the sampler function working at all. When you generate a series of sampling boxes, it is possible that many will be good boxes and some will be bad boxes. My strategy was to create more sampling boxes than I needed, and then to delete bad or unwanted boxes from the resulting spatial object.</p>
<p>R recognizes the sampling boxes as spreadsheets with associated spatial data. Each sampling box is a row of data, and you can delete unwanted rows as shown in the code snippet below. Note the use of the concatenate function <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> to delete multiple samples at once.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># remove unwanted sample from polygons object</span>
<span class="va">samp1</span> <span class="op">&lt;-</span> <span class="va">new_sample</span><span class="op">[</span> , <span class="op">-</span><span class="fl">2</span><span class="op">]</span>  <span class="co"># remove second sample</span>
<span class="va">samp2</span> <span class="op">&lt;-</span> <span class="va">new_sample</span><span class="op">[</span> , <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">7</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span><span class="op">]</span>  <span class="co"># remove samples 3, 7, 8 and 9</span></code></pre></div>
<center>
<img src="examples/bad_boxes.png" width="650"><br><strong>Bad Boxes</strong>
</center>
</div>
<div id="appending-samples" class="section level3">
<h3 class="hasAnchor">
<a href="#appending-samples" class="anchor"></a>Appending Samples</h3>
<p>When you have a pre-existing set of sampling boxes, you may wish to append additional sampling boxes to the end. For instance, you may have a set of sampling boxes used for permit-based monitoring in a previous report. When presented with a list of new permits the county has issued since the last report, you may elect to take a smaller number of samples from the new pool and add these to the pre-existing set.</p>
<p>Since the sampling boxes are represented as lists, you construct a new sampling object by concatenating two lists together using the <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> function.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># just demonstrating how this works</span>
<span class="co"># there is no practical reason to perform these merges</span>

<span class="co"># append permit samples to random samples</span>
<span class="va">merged_1</span> <span class="op">&lt;</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">random_samples</span>, <span class="va">new_sample</span><span class="op">)</span>

<span class="co"># append permit samples to itself</span>
<span class="va">merged_2</span> <span class="op">&lt;</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">new_sample</span>, <span class="va">new_sample</span><span class="op">)</span></code></pre></div>
</div>
<div id="exporting-sampling-boxes" class="section level3">
<h3 class="hasAnchor">
<a href="#exporting-sampling-boxes" class="anchor"></a>Exporting Sampling Boxes</h3>
<p>You can export a polygons object into a shapefile using the <code><a href="http://rgdal.r-forge.r-project.org/reference/writeOGR.html">writeOGR()</a></code> function from the <code>rgdal</code> package. Since there is a lot of good online documentation for that package, I will present an example of how to export your data using the function in the code snippet below, but I will not explain the nuts and bolts in detail. Alternatively, you can save your work as a native R object (.rds format). This is the recommended method if you are storing objects for projects that are in progress, but when you have a finished product consider it best practice to export it to a shapefile, because the county GIS standard is ArcGIS. If you save it only as a native R object, the rest of the staff may be unable to use it on their software.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://rgdal.r-forge.r-project.org">rgdal</a></span><span class="op">)</span>

<span class="co"># export to shapefile</span>
<span class="fu">rgdal</span><span class="fu">::</span><span class="fu"><a href="http://rgdal.r-forge.r-project.org/reference/writeOGR.html">writeOGR</a></span><span class="op">(</span>obj <span class="op">=</span> <span class="va">new_sample</span>, 
                dsn <span class="op">=</span> <span class="st">'path_to_my_dir'</span>,
                layer <span class="op">=</span> <span class="st">'new_sample'</span>,
                driver <span class="op">=</span> <span class="st">'ESRI Shapefile'</span><span class="op">)</span>

<span class="co"># save as native R object</span>
<span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">new_sample</span>, <span class="st">'my_new_sample.rds'</span><span class="op">)</span>  <span class="co"># you must include the .rds extension</span>

<span class="co"># load a saved object</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">'my_new_sample.rds'</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="predicted-cover" class="section level2">
<h2 class="hasAnchor">
<a href="#predicted-cover" class="anchor"></a>Predicted Cover</h2>
<p>The <code><a href="../reference/pred_cover.html">pred_cover()</a></code> function predicts the level of vegetative cover using an NDVI-based model. Over a given spatial polygon, the function predicts the level of cover based upon orthographic imagery, and prints a new raster of predicted cover values to a specified directory <code>out_path</code>.</p>
<p>The full syntax of the function is <code><a href="../reference/pred_cover.html">pred_cover(polys, in_path, out_path, rgb_path = NULL, cir_path = NULL, buff = sf_buff)</a></code>. The argument <code>polys</code> is the spatial polygon object of taxlots over which you want to predict cover. This function is designed to default to 4-band imagery, so the argument <code>in_path</code> is a character string representing a directory path to 4-band imagery. In 2016, the County received 3-band RGB and CIR imagery. If this is the case for you, set the arguments <code>rgb_path</code> and <code>cir_path</code> to directory paths to the RGB and CIR imagery respectively, and do not specify an argument for <code>in_path</code>. The argument <code>buff</code> is the riparian buffer for the WSI hydro-enforced layer clipped to the Rural Residential zone.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># not run</span>
<span class="co"># change directory paths to point to your data</span>

<span class="fu"><a href="../reference/pred_cover.html">pred_cover</a></span><span class="op">(</span><span class="va">random_lots</span>, out_path <span class="op">=</span> <span class="st">'E:/Riparian/pred_2016/'</span>,
           rgb_path <span class="op">=</span> <span class="st">'S:/maps/OrthoPhotos/Hexagon2016/RGB/'</span>,
           cir_path <span class="op">=</span> <span class="st">'S:/maps/OrthoPhotos/Hexagon2016/CIR/'</span><span class="op">)</span>



<span class="fu"><a href="../reference/pred_cover.html">pred_cover</a></span><span class="op">(</span><span class="va">random_lots</span>, <span class="st">'E:/ortho2018'</span>, <span class="st">'E:/Riparian/pred_2018/'</span><span class="op">)</span>

<span class="co"># predict cover change</span>
<span class="fu"><a href="../reference/pred_change.html">pred_change</a></span><span class="op">(</span><span class="st">'E:/Riparian/pred_2016'</span>, <span class="st">'E:/Riparian/pred_2018'</span>, <span class="st">'E:/Riparian/chng_16to18'</span><span class="op">)</span></code></pre></div>
</div>
<div id="predicted-cover-change" class="section level2">
<h2 class="hasAnchor">
<a href="#predicted-cover-change" class="anchor"></a>Predicted Cover Change</h2>
<p>The <code><a href="../reference/pred_change.html">pred_change()</a></code> function predicts the level of change in riparian cover based upon the output of the <code><a href="../reference/pred_cover.html">pred_cover()</a></code> function. The full syntax is <code><a href="../reference/pred_change.html">pred_change(year1_path, year2_path, out_path)</a></code>. The argument <code>year1_path</code> is a character string specifying a directory path to the rasters produced by <code><a href="../reference/pred_cover.html">pred_cover()</a></code> for year 1, and the argument <code>year2_path</code> is a character string specifying a directory path to the rasters produced by <code><a href="../reference/pred_cover.html">pred_cover()</a></code> for year 2. The argument <code>out_path</code> specifies the directory to which the function will print rasters with values of predicted change in cover.</p>
<p>Produce a table summarizing the predicted change in cover using the function <code><a href="../reference/pred_change_report.html">pred_change_report()</a></code>. The full syntax is <code><a href="../reference/pred_change_report.html">pred_change_report(chng_path, year1_path, year2_path, permits = permits_13to18, lots = sf_lots, title = 'pred_chng_table.csv')</a></code>. The argument <code>chng_path</code> is the path to the directory of predicted change rasters produced by <code><a href="../reference/pred_change.html">pred_change()</a></code>. The arguments <code>year1_path</code> and <code>year2_path</code> specify the paths to the directories of predicted cover rasters output by <code><a href="../reference/pred_cover.html">pred_cover()</a></code> for year 1 and year 2 respectively. The argument <code>permits</code> is the same csv file of approved permits you used to produce change tables of randomly selected sites. The default is set to the list of permits from 2013 to 2018 to help demonstrate the functionality of the package in this vignette. The argument <code>lots</code> defaults to a shapefile of taxlots in the priority corridor, and the function uses this file to search for which taxlot a given area of the priority corridor lies within. The argument <code>title</code> specifies the title of the predicted change table, which should end in â€˜.csvâ€™, and prints to the working directory.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># not run</span>
<span class="co"># change directory paths to point to your data</span>

<span class="fu"><a href="../reference/pred_change_report.html">pred_change_report</a></span><span class="op">(</span>chng_path <span class="op">=</span> <span class="st">'E:/Riparian/chng_16to18/'</span>, 
                   year1_path <span class="op">=</span> <span class="st">'E:/Riparian/pred_2016/'</span>, 
                   year2_path <span class="op">=</span> <span class="st">'E:/Riparian/pred_2018/'</span><span class="op">)</span></code></pre></div>
<div class="figure">
<embed src="pred_chng_table.csv"></embed><p class="caption">â€˜pred_change_report output:â€™</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Erik Rose.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
